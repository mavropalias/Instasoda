// =========================================================================
// LikesView
// =========================================================================
var LikesView=Backbone.View.extend({events:{"click .viewLikes":"viewLikes","click .viewFavs":"viewFavs","click .viewDislikes":"viewDislikes","click .likeCategoryTitle":"viewCategory"},initialize:function(){console.log("  ~ initializing LikesView");_.bindAll(this);this.likesFiltersView=new LikesFiltersView({model:this.model});this.likesListView=new LikesListView({model:this.model})},render:function(){console.log("  ~ rendering LikesView");IS.parseLikes(this.model,this.model.get("l"));var e=$("#tplLikes").html();this.$el.html(Mustache.to_html(e,this.model.toJSON()));this.likesFiltersView.setElement(this.$("#likesFilters")).render();this.likesListView.setElement(this.$("#likesResults")).render()},viewLikes:function(){if(!this.$(".viewLikes").hasClass("current")){this.$(".likeCategory").hide();this.$(".likeView").removeClass("current");this.$(".viewLikes").addClass("current");this.$(".catLikes").slideDown()}this.$(".likeCategoryTitle").removeClass("active");this.likesListView.render(2)},viewFavs:function(){if(!this.$(".viewFavs").hasClass("current")){this.$(".likeCategory").hide();this.$(".likeView").removeClass("current");this.$(".viewFavs").addClass("current");this.$(".catFavourites").slideDown()}this.$(".likeCategoryTitle").removeClass("active");this.likesListView.render(3)},viewDislikes:function(){if(!this.$(".viewDislikes").hasClass("current")){this.$(".likeCategory").hide();this.$(".likeView").removeClass("current");this.$(".viewDislikes").addClass("current");this.$(".catDislikes").slideDown()}this.$(".likeCategoryTitle").removeClass("active");this.likesListView.render(1)},viewCategory:function(e){var t=parseInt($(e.currentTarget).data("liketype")),n=$(e.currentTarget).data("cat");this.$(".likeCategoryTitle").removeClass("active");$(e.currentTarget).addClass("active");this.likesListView.render(t,n)}}),LikesFiltersView=Backbone.View.extend({initialize:function(){console.log("  ~ initializing LikesFiltersView");_.bindAll(this);this.model.bind("newSearchLike",this.render);this.model.bind("removedSearchLike",this.render)},render:function(){var e=this;console.log("  ~ rendering LikesFiltersView");var t=$("#tplLikesFilters").html();this.$el.html(Mustache.to_html(t,this.model.toJSON()))}}),LikesListView=Backbone.View.extend({events:{"mouseover .like":"showLikePanel","mouseout .like":"hideLikePanel"},initialize:function(){console.log("  ~ initializing LikesListView");_.bindAll(this);this.renderType=null},render:function(e,t,n){var r=this;this.renderType=1;console.log("  ~ rendering LikesListView");var i=null;if(n)i=this.model.get("commonLikes");else{e>0?e===1?i=this.model.get("dislikes"):e===2?i=this.model.get("likes"):e===3&&(i=this.model.get("favourites")):i=this.model.get("l");if(!IS.nullOrEmpty(t)){var s=i;i=[];$.each(s,function(e,n){s[e].c===t&&i.push(s[e])})}}this.model.set({likesToRender:i});var o=$("#tplLikesList").html();this.$el.html(Mustache.to_html(o,this.model.toJSON()));setTimeout(function(){r.onView()},0)},onView:function(){this.$(".likeImg").appear(function(){$(this).attr("src",$(this).data("src"))})},showLikePanel:function(e){var t=$(e.currentTarget);if(t.find(".likePanel").length>0)t.find(".likePanel").show();else{var n={_id:t.data("id"),n:t.data("name"),c:t.data("cat")},r=new Like(n),i=new FacebookLikePanelView({model:r});i.render();$(e.currentTarget).append(i.el)}},hideLikePanel:function(){this.$(".likePanel").hide()}}),FacebookLikePanelView=Backbone.View.extend({className:"likePanel",events:{"click .addToSearch":"addOrRemoveLikeFromSearchOptions","click .removeFromSearch":"addOrRemoveLikeFromSearchOptions","click .attitude1":"rateLike1","click .attitude2":"rateLike2","click .attitude3":"rateLike3"},initialize:function(){_.bindAll(this);user.bind("newSearchLike",this.render);user.bind("removedSearchLike",this.render)},render:function(){var e=this,t=$("#tplLikePanel").html(),n=this.model.get("_id"),r=user.get("so").l?user.get("so").l:[];_.any(r,function(e){return e._id==n})?this.model.set("isInSearch",!0):this.model.set("isInSearch",!1);this.model.set({like:!1,dislike:!1,fav:!1});var i=_.find(user.get("l"),function(e){return n==e._id});!i||(i.r===2?this.model.set("like",!0):i.r===1?this.model.set("dislike",!0):i.r===3&&this.model.set("fav",!0));this.$el.html(Mustache.to_html(t,this.model.toJSON()))},addOrRemoveLikeFromSearchOptions:function(e){IS.addOrRemoveLikeFromSearchOptions(this.model.get("_id"),this.model.get("n"))},rateLike1:function(){var e=this;IS.addOrRemoveLikeAndRate(this.model.get("_id"),this.model.get("n"),1,this.model.get("c"),function(){e.render()})},rateLike2:function(){var e=this;IS.addOrRemoveLikeAndRate(this.model.get("_id"),this.model.get("n"),2,this.model.get("c"),function(){e.render()})},rateLike3:function(){var e=this;IS.addOrRemoveLikeAndRate(this.model.get("_id"),this.model.get("n"),3,this.model.get("c"),function(){e.render()})}});